{"version":3,"file":"react-form-with-constraints.production.min.js","sources":["../src/withValidateEventEmitter.ts","../src/EventEmitter.ts","../src/fieldWithoutFeedback.ts","../src/FieldsStore.ts","../src/FormWithConstraints.tsx","../src/FieldFeedbacks.tsx","../src/FieldFeedback.tsx"],"sourcesContent":["import { EventEmitter } from './EventEmitter';\nimport Input from './Input';\nimport Constructor from './Constructor';\n\nexport const ValidateEvent = 'VALIDATE_EVENT';\n\nexport type ValidateEventListener = (input: Input) => void;\n\nexport interface IValidateEventEmitter {\n  emitValidateEvent(input: Input): void;\n  addValidateEventListener(listener: ValidateEventListener): void;\n  removeValidateEventListener(listener: ValidateEventListener): void;\n}\n\n// See TypeScript 2.2 Support for Mix-in classes https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-2.html\nexport function withValidateEventEmitter<TBase extends Constructor<{}>>(Base: TBase) {\n  return class ValidateEventEmitter extends Base implements IValidateEventEmitter {\n    validateEventEmitter = new EventEmitter();\n\n    emitValidateEvent(input: Input) {\n      this.validateEventEmitter.emit(ValidateEvent, input);\n    }\n\n    addValidateEventListener(listener: ValidateEventListener) {\n      this.validateEventEmitter.addListener(ValidateEvent, listener);\n    }\n\n    removeValidateEventListener(listener: ValidateEventListener) {\n      this.validateEventEmitter.removeListener(ValidateEvent, listener);\n    }\n  };\n}\n","// FIXME\n// See Thoughts about variadic generics? https://github.com/Microsoft/TypeScript/issues/1773\n// See Proposal: Variadic Kinds -- Give specific types to variadic functions https://github.com/Microsoft/TypeScript/issues/5453\nexport type Args = any[];\n\nexport type Listener = (...args: Args) => void;\n\nexport class EventEmitter {\n  listeners = new Map<string, Listener[]>();\n\n  emit(eventName: string, ...args: Args) {\n    const listeners = this.listeners.get(eventName)!;\n\n    // Assert disabled: mess with the unit tests\n    //console.assert(listeners !== undefined, `Unknown event '${eventName}'`);\n\n    if (listeners !== undefined) {\n      console.assert(listeners.length > 0, `No listener for event '${eventName}'`);\n      listeners.forEach(listener => listener(...args));\n    }\n  }\n\n  addListener(eventName: string, listener: Listener) {\n    if (!this.listeners.has(eventName)) this.listeners.set(eventName, []);\n    const listeners = this.listeners.get(eventName)!;\n    console.assert(listeners.indexOf(listener) === -1, `Listener already added for event '${eventName}'`);\n    listeners.push(listener);\n  }\n\n  // See https://nodejs.org/api/events.html#events_emitter_removelistener_eventname_listener\n  // \"removeListener will remove, at most, one instance of a listener from the listener array.\n  // If any single listener has been added multiple times to the listener array for the specified eventName,\n  // then removeListener must be called multiple times to remove each instance.\"\n  removeListener(eventName: string, listener: Listener) {\n    const listeners = this.listeners.get(eventName)!;\n    console.assert(listeners !== undefined, `Unknown event '${eventName}'`);\n\n    const index = listeners.lastIndexOf(listener);\n    console.assert(index > -1, `Listener not found for event '${eventName}'`);\n    listeners.splice(index, 1);\n\n    if (listeners.length === 0) this.listeners.delete(eventName);\n  }\n}\n","import { Field } from './index';\n\nconst fieldWithoutFeedback: Readonly<Field> = {\n  dirty: false,\n  errors: new Set(),\n  warnings: new Set(),\n  infos: new Set(),\n  validationMessage: ''\n};\n\nexport default fieldWithoutFeedback;\n","import { Fields, Field } from './Fields';\nimport { EventEmitter } from './EventEmitter';\nimport fieldWithoutFeedback from './fieldWithoutFeedback';\n\nexport enum FieldEvent {\n  Added = 'FIELD_ADDED',\n  Removed = 'FIELD_REMOVED',\n  Updated = 'FIELD_UPDATED'\n}\n\nexport class FieldsStore extends EventEmitter {\n  // Why Object.create(null) insteaf of just {}? See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map#Objects_and_maps_compared\n  fields: Fields = Object.create(null);\n\n  addField(fieldName: string) {\n    if (this.fields[fieldName] === undefined) {\n      const newField = fieldWithoutFeedback;\n      this.fields[fieldName] = newField;\n      this.emit(FieldEvent.Added, fieldName, newField);\n    }\n  }\n\n  removeField(fieldName: string) {\n    console.assert(this.fields[fieldName] !== undefined, `Unknown field '${fieldName}'`);\n    delete this.fields[fieldName];\n    this.emit(FieldEvent.Removed, fieldName);\n  }\n\n  cloneField(fieldName: string) {\n    const field = this.fields[fieldName]!;\n    console.assert(field !== undefined, `Unknown field '${fieldName}'`);\n    const newField: Field = {\n      dirty: field.dirty,\n      errors: new Set(field.errors),\n      warnings: new Set(field.warnings),\n      infos: new Set(field.infos),\n      validationMessage: field.validationMessage\n    };\n    return newField;\n  }\n\n  updateField(fieldName: string, field: Field) {\n    console.assert(this.fields[fieldName] !== undefined, `Unknown field '${fieldName}'`);\n    this.fields[fieldName] = field;\n    this.emit(FieldEvent.Updated, fieldName);\n  }\n\n  // Clear the errors/warnings/infos each time we re-validate the input,\n  // this solves the problem with the errors order and show=\"first\", example:\n  // <FieldFeedbacks for=\"username\" show=\"first\"> key=0\n  //   <FieldFeedback ...> key=0.0\n  //   <FieldFeedback ...> key=0.1\n  // </FieldFeedbacks>\n  // We want the first FieldFeedback in the DOM that matches to be displayed\n  // + we have a special case where we could have multiple FieldFeedbacks for the same field\n  removeFieldFor(fieldName: string, fieldFeedbacksKey: number) {\n    const field = this.fields[fieldName]!;\n    console.assert(field !== undefined, `Unknown field '${fieldName}'`);\n\n    // reject is the opposite of filter, see https://lodash.com/docs/#reject\n    // Example: fieldFeedbacksKey = 5, fieldFeedbackKey = 5.2, Math.floor(5.2) = 5\n    const reject = (fieldFeedbackKey: number) => fieldFeedbacksKey !== Math.floor(fieldFeedbackKey);\n\n    field.errors = new Set([...field.errors].filter(reject));\n    field.warnings = new Set([...field.warnings].filter(reject));\n    field.infos = new Set([...field.infos].filter(reject));\n\n    this.emit(FieldEvent.Updated, fieldName);\n  }\n\n  // Retrieve errors/warnings/infos only related to a given FieldFeedbacks\n  getFieldFor(fieldName: string, fieldFeedbacksKey: number) {\n    const field = this.fields[fieldName]!;\n    console.assert(field !== undefined, `Unknown field '${fieldName}'`);\n\n    // Example: fieldFeedbacksKey = 5, fieldFeedbackKey = 5.2, Math.floor(5.2) = 5\n    const filter = (fieldFeedbackKey: number) => fieldFeedbacksKey === Math.floor(fieldFeedbackKey);\n\n    const fieldFor: Readonly<Field> = {\n      dirty: field.dirty,\n      errors: new Set([...field.errors].filter(filter)),\n      warnings: new Set([...field.warnings].filter(filter)),\n      infos: new Set([...field.infos].filter(filter)),\n      validationMessage: field.validationMessage\n    };\n    return fieldFor;\n  }\n\n  containErrors(...fieldNames: string[]) {\n    return fieldNames.some(fieldName => {\n      const field = this.fields[fieldName];\n      return field !== undefined && field.errors.size > 0;\n    });\n  }\n\n  containWarnings(...fieldNames: string[]) {\n    return fieldNames.some(fieldName => {\n      const field = this.fields[fieldName];\n      return field !== undefined && field.warnings.size > 0;\n    });\n  }\n\n  containInfos(...fieldNames: string[]) {\n    return fieldNames.some(fieldName => {\n      const field = this.fields[fieldName];\n      return field !== undefined && field.infos.size > 0;\n    });\n  }\n\n  areValidDirtyWithoutWarnings(...fieldNames: string[]) {\n    return fieldNames.some(fieldName => {\n      const field = this.fields[fieldName];\n      return field !== undefined && field.dirty === true && field.errors.size === 0 && field.warnings.size === 0;\n    });\n  }\n}\n","import * as React from 'react';\nimport * as PropTypes from 'prop-types';\n\nimport { IValidateEventEmitter, withValidateEventEmitter } from './withValidateEventEmitter';\n// @ts-ignore\n// TS6133: 'EventEmitter' is declared but its value is never read.\n// FIXME See https://github.com/Microsoft/TypeScript/issues/9944#issuecomment-309903027\nimport { EventEmitter } from './EventEmitter';\nimport Input from './Input';\nimport { FieldsStore } from './FieldsStore';\n\n// See Form data validation https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/Form_validation\n// See ReactJS Form Validation Approaches http://moduscreate.com/reactjs-form-validation-approaches/\n\n/*\nFormWithConstraints\n  - input\n  - FieldFeedbacks\n    - FieldFeedback\n    - FieldFeedback\n    - ...\n  - input\n  - FieldFeedbacks\n    - FieldFeedback\n    - FieldFeedback\n    - ...\n  - ...\n\nFormWithConstraints contains the FieldsStore:\n{\n  username: {\n    dirty: true,\n    errors: [0.0], // List of FieldFeedback keys\n    warnings: [0.2, 1.1],\n    infos: []\n  },\n  password: {\n    dirty: false,\n    errors: [],\n    warnings: [],\n    infos: []\n  }\n}\nFieldsStore is passed to FieldFeedbacks and FieldFeedback thanks to React context.\n\nMost of the intelligence is inside FieldFeedback validate() and render()\n\nWhen an input changes (validateFields()):\n => FormWithConstraints notifies all FieldFeedbacks\n  => FieldFeedbacks filters unrelated input changes and then notifies its FieldFeedback (validate())\n   => FieldFeedback updates the FieldsStore and emits an event (validate())\n    => FieldFeedbacks re-renders\n*/\n\nexport interface FormWithConstraintsChildContext {\n  form: IFormWithConstraints;\n}\n\nexport interface FormWithConstraintsProps extends React.FormHTMLAttributes<HTMLFormElement> {}\n\nexport interface IFormWithConstraints extends IValidateEventEmitter {\n  fieldsStore: FieldsStore;\n  computeFieldFeedbacksKey(): number;\n}\n\nexport class FormWithConstraintsComponent extends React.Component<FormWithConstraintsProps> {}\nexport class FormWithConstraints extends withValidateEventEmitter(FormWithConstraintsComponent) implements IFormWithConstraints {\n  static childContextTypes = {\n    form: PropTypes.object.isRequired\n  };\n  getChildContext(): FormWithConstraintsChildContext {\n    return {\n      form: this\n    };\n  }\n\n  form: HTMLFormElement;\n\n  fieldsStore = new FieldsStore();\n\n  private fieldFeedbacksKey = 0;\n  computeFieldFeedbacksKey() {\n    return this.fieldFeedbacksKey++;\n  }\n\n  /**\n   * Validates the given fields, either HTMLInputElements or field names.\n   * If called without arguments, validates all fields ($('[name]')).\n   */\n  validateFields(...inputsOrNames: Array<Input | string>) {\n    const inputs = inputsOrNames.filter(inputOrName => typeof inputOrName !== 'string') as Input[];\n    const fieldNames = inputsOrNames.filter(inputOrName => typeof inputOrName === 'string') as string[];\n\n    let otherInputs: Input[] = [];\n\n    // [name] matches <input name=\"...\">, <select name=\"...\">, <button name=\"...\">, ...\n    if (inputsOrNames.length === 0) {\n      otherInputs = this.form.querySelectorAll('[name]') as any;\n    }\n    if (fieldNames.length > 0) {\n      const selectors = fieldNames.map(fieldName => `[name=\"${fieldName}\"]`);\n      otherInputs = this.form.querySelectorAll(selectors.join(', ')) as any;\n    }\n\n    [\n      ...inputs,\n      ...otherInputs\n    ].forEach(input => this.emitValidateEvent(input));\n  }\n\n  // Lazy check => the fields structure might be incomplete\n  isValid() {\n    const fieldNames = Object.keys(this.fieldsStore.fields);\n    return !this.fieldsStore.containErrors(...fieldNames);\n  }\n\n  render() {\n    const { children, ...formProps } = this.props;\n    return <form ref={form => this.form = form!} {...formProps}>{children}</form>;\n  }\n}\n","import * as React from 'react';\nimport * as PropTypes from 'prop-types';\n\nimport { FormWithConstraintsChildContext } from './FormWithConstraints';\nimport { IValidateEventEmitter, withValidateEventEmitter } from './withValidateEventEmitter';\n// @ts-ignore\n// TS6133: 'EventEmitter' is declared but its value is never read.\n// FIXME See https://github.com/Microsoft/TypeScript/issues/9944#issuecomment-309903027\nimport { EventEmitter } from './EventEmitter';\nimport Input from './Input';\nimport { FieldEvent } from './FieldsStore';\n\nexport interface FieldFeedbacksProps extends React.HTMLAttributes<HTMLDivElement> {\n  for: string;\n\n  /**\n   * first => shows only the first error or warning (if no error) encountered, infos are always displayed\n   * all => shows everything\n   */\n  show?: 'first' | 'all';\n}\n\nexport interface FieldFeedbacksChildContext {\n  fieldFeedbacks: IFieldFeedbacks;\n}\n\nexport interface IFieldFeedbacks extends IValidateEventEmitter {\n  props: FieldFeedbacksProps;\n  key: number;\n  computeFieldFeedbackKey(): number;\n}\n\nexport class FieldFeedbacksComponent extends React.Component<FieldFeedbacksProps> {}\nexport class FieldFeedbacks extends withValidateEventEmitter(FieldFeedbacksComponent) {\n  static defaultProps: Partial<FieldFeedbacksProps> = {\n    show: 'first'\n  };\n\n  static contextTypes = {\n    form: PropTypes.object.isRequired\n  };\n  context: FormWithConstraintsChildContext;\n\n  static childContextTypes = {\n    fieldFeedbacks: PropTypes.object.isRequired\n  };\n  getChildContext(): FieldFeedbacksChildContext {\n    return {\n      fieldFeedbacks: this\n    };\n  }\n\n  key: number;\n\n  constructor(props: FieldFeedbacksProps, context: FormWithConstraintsChildContext) {\n    super(props);\n\n    this.validate = this.validate.bind(this);\n    this.reRender = this.reRender.bind(this);\n\n    this.key = context.form.computeFieldFeedbacksKey();\n  }\n\n  // FieldFeedback key = FieldFeedbacks key + increment\n  // Examples:\n  // 0.0, 0.1, 0.2 with 0 being the FieldFeedbacks key\n  // 1.0, 1.1, 1.2 with 1 being the FieldFeedbacks key\n  //\n  // This solves the problem when having multiple FieldFeedbacks with the same for attribute:\n  // <FieldFeedbacks for=\"username\" show=\"first\"> key=0\n  //   <FieldFeedback ...> key=0.0\n  //   <FieldFeedback ...> key=0.1\n  // </FieldFeedbacks>\n  // <FieldFeedbacks for=\"username\" show=\"all\"> key=1\n  //   <FieldFeedback ...> key=1.0\n  //   <FieldFeedback ...> key=1.1\n  //   <FieldFeedback ...> key=1.2\n  // </FieldFeedbacks>\n  //\n  // We could use a string here instead of a number\n  private fieldFeedbackKey = 0;\n  computeFieldFeedbackKey() {\n    // Example: this.key = 5, this.fieldFeedbackKey = 2 => 5 + 2 / 10 = 5 + 0.2 = 5.2\n    return this.key + this.fieldFeedbackKey++ / 10;\n  }\n\n  componentWillMount() {\n    const fieldName = this.props.for;\n    this.context.form.fieldsStore.addField(fieldName);\n\n    this.context.form.addValidateEventListener(this.validate);\n    this.context.form.fieldsStore.addListener(FieldEvent.Updated, this.reRender);\n  }\n\n  componentWillUnmount() {\n    const fieldName = this.props.for;\n    this.context.form.fieldsStore.removeField(fieldName);\n\n    this.context.form.removeValidateEventListener(this.validate);\n    this.context.form.fieldsStore.removeListener(FieldEvent.Updated, this.reRender);\n  }\n\n  validate(input: Input) {\n    const { for: fieldName } = this.props;\n\n    if (input.name === fieldName) { // Ignore the event if it's not for us\n      // Clear the errors/warnings/infos each time we re-validate the input\n      this.context.form.fieldsStore.removeFieldFor(fieldName, this.key);\n\n      this.emitValidateEvent(input);\n    }\n  }\n\n  reRender(_fieldName: string) {\n    const { for: fieldName } = this.props;\n    if (fieldName === _fieldName) { // Ignore the event if it's not for us\n      this.forceUpdate();\n    }\n  }\n\n  render() {\n    const { for: fieldName, show, children, ...divProps } = this.props;\n    return <div {...divProps}>{children}</div>;\n  }\n}\n","import * as React from 'react';\nimport * as PropTypes from 'prop-types';\n\nimport { FormWithConstraintsChildContext } from './FormWithConstraints';\nimport { FieldFeedbacksChildContext } from './FieldFeedbacks';\nimport Input from './Input';\n\nexport type WhenString =\n  | '*'\n  | 'badInput'        // input type=\"number\"\n  | 'patternMismatch' // pattern attribute\n  | 'rangeOverflow'   // max attribute\n  | 'rangeUnderflow'  // min attribute\n  | 'stepMismatch'    // step attribute\n  | 'tooLong'         // maxlength attribute\n  | 'tooShort'        // minlength attribute\n  | 'typeMismatch'    // input type=\"email\" or input type=\"url\"\n  | 'valueMissing';   // required attribute\nexport type WhenFn = (value: string) => boolean;\nexport type When = WhenString | WhenFn;\n\nexport interface FieldFeedbackProps extends React.HTMLAttributes<HTMLDivElement> {\n  when: When;\n  error?: boolean;\n  warning?: boolean;\n  info?: boolean;\n}\n\nexport type FieldFeedbackContext = FormWithConstraintsChildContext & FieldFeedbacksChildContext;\n\nexport class FieldFeedback extends React.Component<FieldFeedbackProps> {\n  static contextTypes = {\n    form: PropTypes.object.isRequired,\n    fieldFeedbacks: PropTypes.object.isRequired\n  };\n  context: FieldFeedbackContext;\n\n  key: number;\n\n  constructor(props: FieldFeedbackProps, context: FieldFeedbackContext) {\n    super(props);\n\n    this.validate = this.validate.bind(this);\n\n    this.key = context.fieldFeedbacks.computeFieldFeedbackKey();\n  }\n\n  componentWillMount() {\n    this.context.fieldFeedbacks.addValidateEventListener(this.validate);\n  }\n\n  componentWillUnmount() {\n    this.context.fieldFeedbacks.removeValidateEventListener(this.validate);\n  }\n\n  // Generates Field for Fields structure\n  validate(input: Input) {\n    const { when, warning, info } = this.props;\n    const { for: fieldName } = this.context.fieldFeedbacks.props;\n\n    let show = false;\n\n    if (typeof when === 'function') {\n      const constraintViolation = when(input.value);\n      if (constraintViolation) {\n        show = true;\n      }\n    }\n\n    else if (typeof when === 'string') {\n      const validity = input.validity;\n\n      if (!validity.valid) {\n        if (when === '*') {\n          show = true;\n        }\n        else if (\n          validity.badInput && when === 'badInput' ||\n          validity.patternMismatch && when === 'patternMismatch' ||\n          validity.rangeOverflow && when === 'rangeOverflow' ||\n          validity.rangeUnderflow && when === 'rangeUnderflow' ||\n          validity.stepMismatch && when === 'stepMismatch' ||\n          validity.tooLong && when === 'tooLong' ||\n          validity.tooShort && when === 'tooShort' ||\n          validity.typeMismatch && when === 'typeMismatch' ||\n          validity.valueMissing && when === 'valueMissing') {\n\n          show = true;\n        }\n      }\n    }\n\n    else {\n      throw new TypeError(`Invalid FieldFeedback 'when' type: ${typeof when}`);\n    }\n\n    // Update the Fields structure\n    const field = this.context.form.fieldsStore.cloneField(fieldName);\n    field.dirty = true;\n    field.validationMessage = input.validationMessage;\n    if (show) {\n      // No need to \"append if not already there\": Set ignores duplicates\n      if (warning) field.warnings.add(this.key);\n      else if (info) field.infos.add(this.key);\n      else field.errors.add(this.key); // Feedback type is error if nothing is specified\n    }\n    this.context.form.fieldsStore.updateField(fieldName, field);\n  }\n\n  render() {\n    const { when, error, warning, info, className, children, ...divProps } = this.props;\n    const { for: fieldName, show } = this.context.fieldFeedbacks.props;\n\n    // Retrieve errors/warnings/infos only related to the parent FieldFeedbacks\n    const { errors, warnings, infos, validationMessage } = this.context.form.fieldsStore.getFieldFor(fieldName, this.context.fieldFeedbacks.key);\n\n    const firstError = errors.values().next().value;\n    const firstWarning = warnings.values().next().value;\n\n    let classes: string | undefined;\n    if (errors.has(this.key) && (show === 'all' || (show === 'first' && firstError === this.key))) {\n      classes = 'error';\n    }\n    else if (warnings.has(this.key) && (errors.size === 0 && (show === 'all' || (show === 'first' && firstWarning === this.key)))) {\n      classes = 'warning';\n    }\n    else if (infos.has(this.key)) {\n      classes = 'info';\n    }\n\n    let feedback = null;\n    if (classes !== undefined) { // Means the FieldFeedback should be displayed\n      classes = className !== undefined ? `${className} ${classes}` : classes;\n      feedback = children !== undefined ? children : validationMessage;\n    }\n\n    return feedback !== null ? <div {...divProps} className={classes}>{feedback}</div> : null;\n  }\n}\n"],"names":["Base","_this","EventEmitter","tslib_1.__extends","ValidateEventEmitter","input","this","validateEventEmitter","emit","ValidateEvent","listener","addListener","removeListener","Map","eventName","_i","args","listeners","get","undefined","console","assert","length","forEach","has","set","indexOf","push","index","lastIndexOf","splice","delete","fieldWithoutFeedback","dirty","errors","Set","warnings","infos","validationMessage","FieldEvent","Object","create","FieldsStore","fieldName","fields","newField","Added","Removed","field","Updated","fieldFeedbacksKey","reject","fieldFeedbackKey","Math","floor","tslib_1.__spread","filter","fieldNames","some","size","React.Component","FormWithConstraints","form","inputsOrNames","inputs","inputOrName","otherInputs","querySelectorAll","selectors","map","join","emitValidateEvent","keys","fieldsStore","_a","containErrors","children","formProps","React.createElement","ref","PropTypes.object","isRequired","withValidateEventEmitter","FormWithConstraintsComponent","props","context","_super","validate","bind","reRender","key","computeFieldFeedbacksKey","FieldFeedbacks","fieldFeedbacks","for","addField","addValidateEventListener","removeField","removeValidateEventListener","name","removeFieldFor","_fieldName","forceUpdate","divProps","show","FieldFeedbacksComponent","computeFieldFeedbackKey","FieldFeedback","when","warning","info","value","TypeError","validity","valid","badInput","patternMismatch","rangeOverflow","rangeUnderflow","stepMismatch","tooLong","tooShort","typeMismatch","valueMissing","cloneField","add","updateField","classes","className","_b","_c","firstError","values","next","firstWarning","feedback"],"mappings":"kiCAeA,WAAwEA,GACtE,mBAAO,aAAA,qDACLC,uBAAuB,IAAIC,IAa7B,OAd0CC,OAGxCC,8BAAA,SAAkBC,GAChBC,KAAKC,qBAAqBC,KAAKC,EAAeJ,IAGhDD,qCAAA,SAAyBM,GACvBJ,KAAKC,qBAAqBI,YAAYF,EAAeC,IAGvDN,wCAAA,SAA4BM,GAC1BJ,KAAKC,qBAAqBK,eAAeH,EAAeC,OAZlBV,gVCT5C,aACEM,eAAY,IAAIO,IAmClB,OAjCEX,iBAAA,SAAKY,OAAmB,aAAAC,mBAAAA,IAAAC,oBACtB,IAAMC,EAAYX,KAAKW,UAAUC,IAAIJ,QAKnBK,IAAdF,IACFG,QAAQC,OAAOJ,EAAUK,OAAS,EAAG,0BAA0BR,OAC/DG,EAAUM,QAAQ,SAAAb,GAAY,OAAAA,iBAAYM,QAI9Cd,wBAAA,SAAYY,EAAmBJ,GACxBJ,KAAKW,UAAUO,IAAIV,IAAYR,KAAKW,UAAUQ,IAAIX,MACvD,IAAMG,EAAYX,KAAKW,UAAUC,IAAIJ,GACrCM,QAAQC,QAAwC,IAAjCJ,EAAUS,QAAQhB,GAAkB,qCAAqCI,OACxFG,EAAUU,KAAKjB,IAOjBR,2BAAA,SAAeY,EAAmBJ,GAChC,IAAMO,EAAYX,KAAKW,UAAUC,IAAIJ,GACrCM,QAAQC,YAAqBF,IAAdF,EAAyB,kBAAkBH,OAE1D,IAAMc,EAAQX,EAAUY,YAAYnB,GACpCU,QAAQC,OAAOO,GAAS,EAAG,iCAAiCd,OAC5DG,EAAUa,OAAOF,EAAO,GAEC,IAArBX,EAAUK,QAAchB,KAAKW,UAAUc,OAAOjB,SDrCzCL,EAAgB,iBEFvBuB,GACJC,OAAO,EACPC,OAAQ,IAAIC,IACZC,SAAU,IAAID,IACdE,MAAO,IAAIF,IACXG,kBAAmB,KCHrB,SAAYC,GACVA,sBACAA,0BACAA,0BAHF,CAAYA,eAAAA,kBAMZ,kBAAA,aAAA,qDAEEtC,SAAiBuC,OAAOC,OAAO,QAuGjC,OAzGiCtC,OAI/BuC,qBAAA,SAASC,GACP,QAA+BxB,IAA3Bb,KAAKsC,OAAOD,GAA0B,CACxC,IAAME,EAAWb,EACjB1B,KAAKsC,OAAOD,GAAaE,EACzBvC,KAAKE,KAAK+B,aAAWO,MAAOH,EAAWE,KAI3CH,wBAAA,SAAYC,GACVvB,QAAQC,YAAkCF,IAA3Bb,KAAKsC,OAAOD,GAA0B,kBAAkBA,cAChErC,KAAKsC,OAAOD,GACnBrC,KAAKE,KAAK+B,aAAWQ,QAASJ,IAGhCD,uBAAA,SAAWC,GACT,IAAMK,EAAQ1C,KAAKsC,OAAOD,GAC1BvB,QAAQC,YAAiBF,IAAV6B,EAAqB,kBAAkBL,OAQtD,OANEV,MAAOe,EAAMf,MACbC,OAAQ,IAAIC,IAAIa,EAAMd,QACtBE,SAAU,IAAID,IAAIa,EAAMZ,UACxBC,MAAO,IAAIF,IAAIa,EAAMX,OACrBC,kBAAmBU,EAAMV,oBAK7BI,wBAAA,SAAYC,EAAmBK,GAC7B5B,QAAQC,YAAkCF,IAA3Bb,KAAKsC,OAAOD,GAA0B,kBAAkBA,OACvErC,KAAKsC,OAAOD,GAAaK,EACzB1C,KAAKE,KAAK+B,aAAWU,QAASN,IAWhCD,2BAAA,SAAeC,EAAmBO,GAChC,IAAMF,EAAQ1C,KAAKsC,OAAOD,GAC1BvB,QAAQC,YAAiBF,IAAV6B,EAAqB,kBAAkBL,OAItD,IAAMQ,EAAS,SAACC,GAA6B,OAAAF,IAAsBG,KAAKC,MAAMF,IAE9EJ,EAAMd,OAAS,IAAIC,IAAIoB,EAAIP,EAAMd,QAAQsB,OAAOL,IAChDH,EAAMZ,SAAW,IAAID,IAAIoB,EAAIP,EAAMZ,UAAUoB,OAAOL,IACpDH,EAAMX,MAAQ,IAAIF,IAAIoB,EAAIP,EAAMX,OAAOmB,OAAOL,IAE9C7C,KAAKE,KAAK+B,aAAWU,QAASN,IAIhCD,wBAAA,SAAYC,EAAmBO,GAC7B,IAAMF,EAAQ1C,KAAKsC,OAAOD,GAC1BvB,QAAQC,YAAiBF,IAAV6B,EAAqB,kBAAkBL,OAGtD,IAAMa,EAAS,SAACJ,GAA6B,OAAAF,IAAsBG,KAAKC,MAAMF,IAS9E,OANEnB,MAAOe,EAAMf,MACbC,OAAQ,IAAIC,IAAIoB,EAAIP,EAAMd,QAAQsB,OAAOA,IACzCpB,SAAU,IAAID,IAAIoB,EAAIP,EAAMZ,UAAUoB,OAAOA,IAC7CnB,MAAO,IAAIF,IAAIoB,EAAIP,EAAMX,OAAOmB,OAAOA,IACvClB,kBAAmBU,EAAMV,oBAK7BI,0BAAA,eAAc,oBAAA3B,mBAAAA,IAAA0C,kBACZ,OAAOA,EAAWC,KAAK,SAAAf,GACrB,IAAMK,EAAQ/C,EAAK2C,OAAOD,GAC1B,YAAiBxB,IAAV6B,GAAuBA,EAAMd,OAAOyB,KAAO,KAItDjB,4BAAA,eAAgB,oBAAA3B,mBAAAA,IAAA0C,kBACd,OAAOA,EAAWC,KAAK,SAAAf,GACrB,IAAMK,EAAQ/C,EAAK2C,OAAOD,GAC1B,YAAiBxB,IAAV6B,GAAuBA,EAAMZ,SAASuB,KAAO,KAIxDjB,yBAAA,eAAa,oBAAA3B,mBAAAA,IAAA0C,kBACX,OAAOA,EAAWC,KAAK,SAAAf,GACrB,IAAMK,EAAQ/C,EAAK2C,OAAOD,GAC1B,YAAiBxB,IAAV6B,GAAuBA,EAAMX,MAAMsB,KAAO,KAIrDjB,yCAAA,eAA6B,oBAAA3B,mBAAAA,IAAA0C,kBAC3B,OAAOA,EAAWC,KAAK,SAAAf,GACrB,IAAMK,EAAQ/C,EAAK2C,OAAOD,GAC1B,YAAiBxB,IAAV6B,IAAuC,IAAhBA,EAAMf,OAAwC,IAAtBe,EAAMd,OAAOyB,MAAsC,IAAxBX,EAAMZ,SAASuB,WAtGrEzD,iBCuDjC,4DAA6F,OAA3CC,UAAAyD,2BAClD,aAAA,qDAYE3D,cAAc,IAAIyC,EAEVzC,oBAAoB,IAwC9B,OAtDyCE,OAIvC0D,4BAAA,WACE,OACEC,KAAMxD,OASVuD,qCAAA,WACE,OAAOvD,KAAK4C,qBAOdW,2BAAA,eAAe,oBAAA9C,mBAAAA,IAAAgD,kBACb,IAAMC,EAASD,EAAcP,OAAO,SAAAS,GAAe,MAAuB,iBAAhBA,IACpDR,EAAaM,EAAcP,OAAO,SAAAS,GAAe,MAAuB,iBAAhBA,IAE1DC,KAMJ,GAH6B,IAAzBH,EAAczC,SAChB4C,EAAc5D,KAAKwD,KAAKK,iBAAiB,WAEvCV,EAAWnC,OAAS,EAAG,CACzB,IAAM8C,EAAYX,EAAWY,IAAI,SAAA1B,GAAa,MAAA,UAAUA,SACxDuB,EAAc5D,KAAKwD,KAAKK,iBAAiBC,EAAUE,KAAK,OAG1Df,EACKS,EACAE,GACH3C,QAAQ,SAAAlB,GAAS,OAAAJ,EAAKsE,kBAAkBlE,MAI5CwD,oBAAA,WACE,IAAMJ,EAAajB,OAAOgC,KAAKlE,KAAKmE,YAAY7B,QAChD,QAAQ8B,EAAApE,KAAKmE,aAAYE,wBAAiBlB,WAG5CI,mBAAA,WAAA,WACQa,aAAEE,aAAUC,oBAClB,OAAOC,0BAAMC,IAAK,SAAAjB,GAAQ,OAAA7D,EAAK6D,KAAOA,IAAWe,GAAYD,IAnDxDf,qBACLC,KAAMkB,SAAiBC,eAFcC,EAAyBC,kBClClE,4DAAmF,OAAtChF,UAAAyD,2BAsB3C,WAAYwB,EAA4BC,GAAxC,MACEC,YAAMF,gBAyBAnF,mBAAmB,EAvBzBA,EAAKsF,SAAWtF,EAAKsF,SAASC,KAAKvF,GACnCA,EAAKwF,SAAWxF,EAAKwF,SAASD,KAAKvF,GAEnCA,EAAKyF,IAAML,EAAQvB,KAAK6B,6BAgE5B,OA3FoCxF,OAalCyF,4BAAA,WACE,OACEC,eAAgBvF,OAiCpBsF,oCAAA,WAEE,OAAOtF,KAAKoF,IAAMpF,KAAK8C,mBAAqB,IAG9CwC,+BAAA,WACE,IAAMjD,EAAYrC,KAAK8E,MAAMU,IAC7BxF,KAAK+E,QAAQvB,KAAKW,YAAYsB,SAASpD,GAEvCrC,KAAK+E,QAAQvB,KAAKkC,yBAAyB1F,KAAKiF,UAChDjF,KAAK+E,QAAQvB,KAAKW,YAAY9D,YAAY4B,aAAWU,QAAS3C,KAAKmF,WAGrEG,iCAAA,WACE,IAAMjD,EAAYrC,KAAK8E,MAAMU,IAC7BxF,KAAK+E,QAAQvB,KAAKW,YAAYwB,YAAYtD,GAE1CrC,KAAK+E,QAAQvB,KAAKoC,4BAA4B5F,KAAKiF,UACnDjF,KAAK+E,QAAQvB,KAAKW,YAAY7D,eAAe2B,aAAWU,QAAS3C,KAAKmF,WAGxEG,qBAAA,SAASvF,GACC,IAAAsC,iBAEJtC,EAAM8F,OAASxD,IAEjBrC,KAAK+E,QAAQvB,KAAKW,YAAY2B,eAAezD,EAAWrC,KAAKoF,KAE7DpF,KAAKiE,kBAAkBlE,KAI3BuF,qBAAA,SAASS,oBAEWA,GAChB/F,KAAKgG,eAITV,mBAAA,WACE,IAAMlB,aAAwBE,4BAAU2B,iCACxC,OAAOzB,2BAASyB,GAAW3B,IAxFtBgB,gBACLY,KAAM,SAGDZ,gBACL9B,KAAMkB,SAAiBC,YAIlBW,qBACLC,eAAgBb,SAAiBC,eAXDC,EAAyBuB,kBCM3D,WAAYrB,EAA2BC,GAAvC,MACEC,YAAMF,gBAENnF,EAAKsF,SAAWtF,EAAKsF,SAASC,KAAKvF,GAEnCA,EAAKyF,IAAML,EAAQQ,eAAea,4BA8FtC,OA5GmCvG,OAiBjCwG,+BAAA,WACErG,KAAK+E,QAAQQ,eAAeG,yBAAyB1F,KAAKiF,WAG5DoB,iCAAA,WACErG,KAAK+E,QAAQQ,eAAeK,4BAA4B5F,KAAKiF,WAI/DoB,qBAAA,SAAStG,GACD,IAAAqE,aAAEkC,SAAMC,YAASC,SACfnE,wCAEJ6D,GAAO,EAEX,GAAoB,mBAATI,EAAqB,CACFA,EAAKvG,EAAM0G,SAErCP,GAAO,OAIN,CAAA,GAAoB,iBAATI,EAwBd,MAAM,IAAII,UAAU,6CAA6CJ,GAvBjE,IAAMK,EAAW5G,EAAM4G,SAElBA,EAASC,QACC,MAATN,EACFJ,GAAO,GAGPS,EAASE,UAAqB,aAATP,GACrBK,EAASG,iBAA4B,oBAATR,GAC5BK,EAASI,eAA0B,kBAATT,GAC1BK,EAASK,gBAA2B,mBAATV,GAC3BK,EAASM,cAAyB,iBAATX,GACzBK,EAASO,SAAoB,YAATZ,GACpBK,EAASQ,UAAqB,aAATb,GACrBK,EAASS,cAAyB,iBAATd,GACzBK,EAASU,cAAyB,iBAATf,KAEzBJ,GAAO,IAUb,IAAMxD,EAAQ1C,KAAK+E,QAAQvB,KAAKW,YAAYmD,WAAWjF,GACvDK,EAAMf,OAAQ,EACde,EAAMV,kBAAoBjC,EAAMiC,kBAC5BkE,IAEEK,EAAS7D,EAAMZ,SAASyF,IAAIvH,KAAKoF,KAC5BoB,EAAM9D,EAAMX,MAAMwF,IAAIvH,KAAKoF,KAC/B1C,EAAMd,OAAO2F,IAAIvH,KAAKoF,MAE7BpF,KAAK+E,QAAQvB,KAAKW,YAAYqD,YAAYnF,EAAWK,IAGvD2D,mBAAA,WACE,IASIoB,EATErD,aAA8BsD,gDAAWpD,aAAU2B,gEACnD0B,oCAAEtF,QAAgB6D,SAGlB0B,+EAAEhG,WAAQE,aAAUC,UAAOC,sBAE3B6F,EAAajG,EAAOkG,SAASC,OAAOtB,MACpCuB,EAAelG,EAASgG,SAASC,OAAOtB,MAG1C7E,EAAOV,IAAIlB,KAAKoF,OAAkB,QAATc,GAA4B,UAATA,GAAoB2B,IAAe7H,KAAKoF,KACtFqC,EAAU,QAEH3F,EAASZ,IAAIlB,KAAKoF,MAAyB,IAAhBxD,EAAOyB,OAAwB,QAAT6C,GAA4B,UAATA,GAAoB8B,IAAiBhI,KAAKoF,KACrHqC,EAAU,UAEH1F,EAAMb,IAAIlB,KAAKoF,OACtBqC,EAAU,QAGZ,IAAIQ,EAAW,KAMf,YALgBpH,IAAZ4G,IACFA,OAAwB5G,IAAd6G,EAA6BA,MAAaD,EAAYA,EAChEQ,OAAwBpH,IAAbyD,EAAyBA,EAAWtC,GAG7B,OAAbiG,EAAoBzD,2BAASyB,GAAUyB,UAAWD,IAAUQ,GAAkB,MAzGhF5B,gBACL7C,KAAMkB,SAAiBC,WACvBY,eAAgBb,SAAiBC,eAHFrB"}